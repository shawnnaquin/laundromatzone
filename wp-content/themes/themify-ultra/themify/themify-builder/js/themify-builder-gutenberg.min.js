(function(b,d,e){var f=e.createElement;b.builderUtils={stateInit:!1,number:0,tempHTML:null,vent:_.extend({},Backbone.Events),isRendered:function(){return document.getElementById("tb_toolbar")},saveHTML:function(a){this.isRendered()&&(this.tempHTML=document.getElementById("themify-builder-canvas-block").innerHTML)},restoreHTML:function(a){if("undefined"!==typeof themifybuilderapp&&(a=themifybuilderapp,!_.isNull(this.tempHTML)&&!this.isRendered()&&document.getElementById("themify-builder-canvas-block")&&
(document.getElementById("themify-builder-canvas-block").innerHTML=this.tempHTML,!_.isUndefined(a.Instances.Builder[0])))){for(var c=document.getElementById("themify_builder_row_wrapper").querySelectorAll("[data-cid]"),c=Array.prototype.slice.call(c),b=0,e=c.length;b<e;++b){var d=a.Models.Registry.lookup(c[b].getAttribute("data-cid"));d&&d.trigger("change:view",c[b])}a.toolbar.setElement($("#tb_toolbar")).render();a.Instances.Builder[0].setElement($("#themify_builder_row_wrapper"));a.Instances.Builder[0].init(!0)}},
manageState:function(a){if("undefined"!==typeof themifybuilderapp&&!this.stateInit){this.stateInit=!0;console.log("manageState_callback");var c=themifybuilderapp;c.vent.on("dom:change",function(){c.hasChanged&&a.setAttributes({data:b.builderUtils.number++})});c.vent.on("backend:switchfrontend",function(a){window.parent.location.href=a})}},saveBlock:function(){"undefined"!==typeof themifybuilderapp&&(console.log("save_callback"),themifybuilderapp.hasChanged?themifybuilderapp.Utils.saveBuilder(this.goToFrontend):
this.goToFrontend())},goToFrontend:function(){themifybuilderapp.redirectFrontend&&themifybuilderapp.vent.trigger("backend:switchfrontend",themifybuilderapp.redirectFrontend)}};b.registerBlockType("themify-builder/canvas",{title:"Themify Builder",icon:"layout",category:"layout",useOnce:!0,attributes:{data:{source:"meta"}},edit:function(a){console.log("edit");b.builderUtils.vent.trigger("edit",a);return f("div",{id:"themify-builder-canvas-block"},"placeholder builder")},save:function(){console.log("save");
return null}});d=_.debounce(function(a){b.builderUtils.saveHTML(a);b.builderUtils.restoreHTML(a);b.builderUtils.manageState(a)},800);e=_.debounce(function(){b.builderUtils.saveBlock()},800);b.builderUtils.vent.on("edit",d);b.builderUtils.vent.on("save",e);jQuery(document).ajaxComplete(function(a,c,d){a=d.url;c="post.php?post="+themifyBuilder.post_ID+"&action=edit&classic-editor=1&meta_box=1";"POST"===d.type&&-1!==a.indexOf(c)&&b.builderUtils.vent.trigger("save")})})(window.wp.blocks,window.wp.i18n,
window.wp.element);
